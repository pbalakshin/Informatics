% !TeX root = ../../main.tex
\subsection{Многоуровневая модель OSI (Open Systems Interconnection)}\label{subsec:osi-model}

Процесс передачи данных по компьютерной сети очень сложен, поэтому специалисты International Standards Organization решили разделить его на семь логических независимых уровней. Специалист на одном уровне может работать независимо от специалиста на другом уровне, не мешая друг другу.

\begin{table}[!htbp]
    \centering
    \caption{Модель OSI}\label{tab:osi-model}
    \begin{tabularx}{\textwidth}{|c|c|X|}
        \hline
        \thead{№} & \thead{Название уровня (layer)} & \thead{Основная функция} \\ \hline
        7 & Прикладной (application)        & взаимодействие программы пользователя  с сетевой подсистемой ОС (API) \\ \hline
        6 & Представления (presentation)    & шифрование, сжатие, выбор кодировки \\ \hline
        5 & Сеансовый (session)             & установление соединения \\ \hline
        4 & Транспортный (transport)        & надежность доставки, реакция на потери \\ \hline
        3 & Сетевой (network)               & маршрутизация, объединение разнородных локальных сетей, адресация в глобальной сети (IP) \\ \hline
        2 & Канальный (data link)           & связь между узлами одной локальной сети, адресация в локальной сети (МАС-адрес) \\ \hline
        1 & Физический (physical)           & физические характеристики каналов связи и передаваемых сигналов \\ \hline
    \end{tabularx}
\end{table}

\subsubsection{Прикладной уровень}\label{subsubsec:application-layer}

\emph{Субъекты взаимодействия:} пользовательская программа на передающем/принимающем компьютере; ОС.

\emph{Объекты взаимодействия:} Пользовательские данные, представленные в \enquote{родном} понятном виде для приемной и передающей программы.

\emph{Основные функции:} Вызов специальных функций ОС для работы с сетью (API). Программист не обязан знать о внутреннем устройстве
сети, для него передача данных по сети не отличается от сохранения в файл (просто надо вызвать нужную функцию API ОС).

\textbf{API~\footnote{API (от англ. \emph{application programming interface}) --- интерфейс программирования приложений, интерфейс прикладного программирования}} --- набор готовых классов, процедур, функций, структур и констант, предоставляемых приложением (библиотекой, сервисом) для использования во внешних программных продуктах.
Используется программистами при написании всевозможных приложений.

\subsubsection{Уровень представления}\label{subsubsec:presentation-layer}
\emph{Субъекты взаимодействия:} специальное ПО для шифрования, сжатия, кодирования; ОС.

\emph{Объекты взаимодействия:} Закодированные пользовательские данные (пользовательская программа уже не может работать с такими данными без декодирования).

\emph{Основные функции:} Шифрование, сжатие, выбор кодировки, выбор способа представления порядка байт (little-endian, big-endian).
Каждый этап может выполняться несколько раз разными субъектами.

\subsubsection{Сеансовый уровень}\label{subsubsec:session-layer}

\emph{Субъекты взаимодействия:} ОС на компьютере-передатчике; ОС на компьютере-приемнике.

\emph{Объекты взаимодействия:} Служебные данные о об установке соединения: логины, пароли, сертификаты, цифровые подписи, пустые пакеты для проверки отсутствия обрывов связи, служебные пакеты с командами типа \enquote{запрос соединения}, \enquote{подтверждение соединения}, \enquote{разрыв соединения} (т.е. никакие пользовательские данные на этом уровне не передаются).

\emph{Основные функции:}
\begin{itemize}
    \item Установление соединения (с возможной аутентификацией абонентов).
    \item Отслеживание состояния соединения (возможное автопереподключение при обнаружении ошибок).
    \item Реагирование на долгую неактивность сеанса связи (например, автоотсоединение по таймауту).
    \item Принудительный разрыв соединения при окончании передачи (попутно освобождаются ресурсы ОС, которые хранят информацию о состоянии сеанса).
\end{itemize}

\subsubsection{Транспортный уровень}\label{subsubsec:transport-layer}

\emph{Субъекты взаимодействия:} ОС; драйвер сетевой карты.

\emph{Объекты взаимодействия:} Пользовательские данные, снабженные служебными заголовками для обнаружения проблем передачи (контрольная сумма, порядковые номера фрагментов), служебные пакеты-подтверждения.

\emph{Основные функции:}
\begin{itemize}
    \item Отслеживание проблемных пакетов: искаженных, потерянных, пришедших в неверном порядке или дубликатов.
    \item Реакция на обнаружение проблемных пакетов (запрос повторной передачи или игнорирование, сбор целых пакетов из пришедших в разном порядке фрагментов).
    \item Реализация механизма повторной передачи (передается весь файл целиком или только проблемные части).
\end{itemize}

\subsubsection{Сетевой уровень}\label{subsubsec:network-layer}

\emph{Субъекты взаимодействия:} ОС; драйвер сетевой карты.

\emph{Объекты взаимодействия:} Данные, нарезанные на фрагменты, которые можно передавать в конкретной локальной сети (например, в
проводных сетях Fast Ethernet предельный размер фрагмента $\approx$ 1500 байт, а в сетях Wi-Fi он равен $\approx$ 8000 байт). Каждый фрагмент снабжается глобальным адресом (например, IP-адресом), который понятен в любой локальной сети, но при этом уникален для всей
глобальной сети.

\emph{Основные функции:} Маршрутизация в большой сети; обеспечение возможности объединить несколько разнородных локальных сетей в одну сеть.

\subsubsection{Канальный уровень}\label{subsubsec:data-link-layer}
\emph{Субъекты взаимодействия:} драйвер сетевой карты; модуль сетевой карты, который генерирует физические сигналы (ток, радиоволна, пучок света).

\emph{Объекты взаимодействия:} Набор битов, полностью готовых к передаче от одного компьютера локальной сети к другому (без выхода в глобальную сеть). Помимо данных пользователя, в этот набор включают адреса приёмника и передатчика внутри локальной сети (например, MAC-адреса).

\emph{Основные функции:}
\begin{itemize}
    \item Проверка доступности (свободности) канала связи, если он общий для нескольких абонентов. Например, в Wi-Fi-канал является общим для нескольких устройств в радиусе действия базовой станции, поэтому он не всегда доступен для передачи и каждому устройству приходится ждать своей очереди.
    \item Передача данных и адресация осуществляются только внутри локальной сети (MAC-адрес имеет смысл только в пределах локальной сети, так как он не передаётся в глобальную сеть).
\end{itemize}

\subsubsection{Физический уровень}\label{subsubsec:physical-layer}
\emph{Субъекты взаимодействия:} модуль сетевой карты, который генерирует физические сигналы (ток, радиоволна, пучок света); проводник сигнала (медный кабель, оптоволокно, радиоэфир).

\emph{Объекты взаимодействия:} Физические сигналы (ток, пучок света, радиоволна).

\emph{Основные функции:} Выбор носителя сигнала (ток, свет, радиоволна). Выбор свойств проводника сигнала (материал: медь,
оптоволокно; диаметр сечения, сопротивление, предельно допустимая длина). Выбор способа представления цифровых данных в виде физического сигнала (кодирование, модуляция).

\paragraph{Кодирование}\label{par:encoding}
0 и 1 можно представить в виде разного напряжения электрического тока. Самый интуитивно-понятный способ называется $NRZ$. Однако существует много других способов, устраняющих недостатки $NRZ$ (например, проблему вырождения переменного сигнала в постоянный ток, если передаются много единиц подряд).

\begin{figure}[H]
    \centering
    \includegraphics[width=10cm]{src/11_osi/11_1.jpg}
    \caption*{Различные системы кодирования данных}
\end{figure}

\paragraph{Модуляция}\label{par:modulation}
Если сетевая карта умеет генерировать физический сигнал в виде синусоиды, то управляя амплитудой/частотой/фазой этой синусоиды, можно кодировать 0 и 1.

\begin{figure}[H]
    \centering
    \includegraphics[width=10cm]{src/11_osi/11_2.jpg}
    \caption*{а) информационный сигнал, \\ б) амплитудная модуляция (AM), \\ в) частотная модуляция (FM), \\ г) фазовая модуляция (PM)}
\end{figure}

\subsubsection{Адекватность OSI-модели}\label{subsubsec:osi-model-adequacy}
Не существует ни одной сетевой технологии, в которой бы была идеально реализована вся OSI-модель с четким разделением уровней.
Модель OSI далека от реальности, ее назначение --- быть идеальной абстракцией.

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|}
    \hline
    Реальность & OSI-уровни \\\hline
    Skype & 7,6,5 \\ \hline
    FTP & 7,3 \\ \hline
    TCP & 7,5,4,3 \\ \hline
    IP & 3,4 \\ \hline
    Wi-Fi & 1,2 \\ \hline
    Fast-Ethernet & 1,2 \\ \hline
    \end{tabular}
\end{table}

\subsection{Отличие TCP от UDP}\label{subsec:tcp-vs-udp}
\begin{table}[H]
    \centering
    \begin{tabular}{|l|c|c|}
    \hline
    Свойство & TCP & UDP \\ \hline
    Установка соединения & $\checkmark$ & $\times$ \\
    Разрыв соединения &  $\checkmark$ & $\times$ \\
    Подтверждение доставки &  $\checkmark$ & $\times$ \\
    Проверка контрольной суммы  & $\checkmark$ & $\checkmark$ \\
    Обнаружение искаженных пакетов & $\checkmark$ & $\checkmark$ \\
    Обнаружение потерянных пакетов & $\checkmark$ & $\times$ \\
    Повторная передача потерянных/искаженных & $\checkmark$ & $\times$ \\
    \hline
    \end{tabular}
\end{table}

\subparagraph{TCP} применяют, если необходимо удостовериться, что все данные дошли корректно, получив об этом подтверждение и организовав повторную передачу поврежденных данных (пример: передача почты).

\subparagraph{UDP} применяют либо если канал связи абсолютно надежен, либо если нет смысла повторно передавать потерянные/искаженные пакеты (пример: видео-звонок), но при этом хочется сэкономить на передаче ненужных служебных данных, используемых в ТСР.
